{% extends "base.html" %}

{% block title %}Surrounding Networks - Advanced Network Scanner{% endblock %}

{% block header %}üì° Surrounding Networks Detection{% endblock %}

{% block subtitle %}Automatically detect and scan nearby networks{% endblock %}

{% block content %}
<div class="card">
    <h2>üîç Network Detection</h2>
    <div class="network-info">
        <p>This feature automatically detects your network interfaces and surrounding networks. 
        It will identify your current network and suggest scanning nearby networks.</p>
    </div>
    
    <div class="detection-steps">
        <h3>How It Works:</h3>
        <div class="step">
            <strong>1. Interface Detection</strong>
            <p>Automatically detects all network interfaces on your system</p>
        </div>
        <div class="step">
            <strong>2. Network Analysis</strong>
            <p>Identifies your current network and subnet configuration</p>
        </div>
        <div class="step">
            <strong>3. Gateway Detection</strong>
            <p>Finds your default gateway and routing information</p>
        </div>
        <div class="step">
            <strong>4. Scan Suggestion</strong>
            <p>Suggests networks to scan based on your current configuration</p>
        </div>
    </div>
    
    <div class="form-group">
        <label for="network">Or manually enter a network to scan:</label>
        <input type="text" id="network" name="network" value="192.168.1.0/24" placeholder="e.g., 192.168.1.0/24">
    </div>
    
    <button onclick="detectAndScanNetworks()">üîç Detect & Scan Networks</button>
</div>

<div class="card">
    <h2>üåê Detected Networks</h2>
    <div class="detected-networks" id="networksContainer">
        <p>Click "Detect & Scan Networks" to automatically detect surrounding networks.</p>
        <div class="network-item">
            <div>
                <strong>192.168.1.0/24</strong>
                <p>Default network (manually added)</p>
            </div>
            <button class="scan-btn" onclick="scanNetwork('192.168.1.0/24')">Scan</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function detectAndScanNetworks() {
        // In a real implementation, this would detect networks and show them
        alert('In a full implementation, this would automatically detect surrounding networks. For now, you can manually scan networks.');
        
        // For demo, we'll just show a sample network
        const container = document.getElementById('networksContainer');
        container.innerHTML = `
            <div class="network-item">
                <div>
                    <strong>192.168.1.0/24</strong>
                    <p>Detected network (current)</p>
                </div>
                <button class="scan-btn" onclick="scanNetwork('192.168.1.0/24')">Scan</button>
            </div>
            <div class="network-item">
                <div>
                    <strong>10.0.0.0/24</strong>
                    <p>Potential surrounding network</p>
                </div>
                <button class="scan-btn" onclick="scanNetwork('10.0.0.0/24')">Scan</button>
            </div>
        `;
    }
    
    function scanNetwork(network) {
        if (confirm('Start vulnerability scan on ' + network + '?')) {
            // Show loading
            const container = document.getElementById('networksContainer');
            container.innerHTML = '<p>Scanning network ' + network + '... Please wait.</p>';
            
            fetch('/api/scan_network', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    network: network,
                    scan_type: 'full'
                })
            })
            .then(response => response.json())
            .then(data => {
                alert('Vulnerability scan started: ' + data.network);
                // Redirect to results page when complete
                setTimeout(() => {
                    window.location.href = '/results';
                }, 3000);
            })
            .catch(error => {
                container.innerHTML = '<p>Error starting scan: ' + error + '</p>';
            });
        }
    }
</script>
{% endblock %}